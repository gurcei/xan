#OUTPUT "XANADU-BASIC65"'============.DECLARATIONS'============  ' MUSIC RELATED VARS  ' ------------------  #DECLARE MUSIC¯CHUNK¯INDEX     ' OLD T  #DECLARE BAR¯INDEX             ' OLD TT  #DECLARE MAP¯BAR¯TO¯CHUNK(10)  ' OLD M()  #DECLARE V1$(4), V2$(4), V3$(4), V4$(4)  ' PALETTE  ' -------  #DECLARE DEFAULT¯RED(32)  #DECLARE DEFAULT¯GREEN(32)  #DECLARE DEFAULT¯BLUE(32)  #DECLARE CURR¯RED(32)  #DECLARE CURR¯GREEN(32)  #DECLARE CURR¯BLUE(32)  #DECLARE FADEVAL, TEMPVAL  ' MISC  ' ----  #DECLARE K,M,N  #DECLARE RAINBOWSTR$  #DECLARE RAINBOW¯X, RAINBOW¯Y  #DECLARE PLEN=0'====.MAIN'====  GOSUB INIT  GOSUB BAS¯LOGO  ' GOSUB XANADU¯TITLE  ' GOSUB PETSCII¯STORY  ' TODO: LOAD NEXT PART OF DEMO (DANCING MUSES)  END'========.BAS¯LOGO'========  GOSUB POLL¯PLAY  GOSUB FADE¯TO¯WHITE  GOSUB DRAW¯LOGO  GOSUB FADE¯TO¯DEFAULTS  GOSUB CYCLE¯ALT¯PALETTE¯LOOP  GOSUB FADE¯TO¯BLACK  RETURN.CYCLE¯ALT¯PALETTE¯LOOP'----------------------  FOR M = 0 TO 32*4    GOSUB CYCLE¯ALT¯PALETTE    GOSUB POLL¯PLAY    GOSUB ANIM¯DRAW¯PRESENTS    SLEEP .05  NEXT M  RETURN.ANIM¯DRAW¯PRESENTS'------------------  #DECLARE PRES$="PRESENTS..."  IF PLEN < LEN(PRES$) THEN BEGIN    PLEN = PLEN + 1    RAINBOWSTR$=LEFT$(PRES$,PLEN)    RAINBOW¯X = 36    RAINBOW¯Y = 24    GOSUB PRINT¯RAINBOW¯STR  BEND  RETURN.PRINT¯RAINBOW¯STR  #DECLARE RAIN¯IDX  CURSOR RAINBOW¯X, RAINBOW¯Y  FOR RAIN¯IDX=1 TO LEN(RAINBOWSTR$)    FOREGROUND MOD(RAIN¯IDX-1,16)+16    PRINT MID$(RAINBOWSTR$,RAIN¯IDX,1);  NEXT RAIN¯IDX  RETURN.CYCLE¯ALT¯PALETTE'-----------------  #DECLARE TEMPR, TEMPG, TEMPB  TEMPR = PEEK($D100+16)  TEMPG = PEEK($D200+16)  TEMPB = PEEK($D300+16)  FOR K = 16 TO 30    POKE $D100+K, PEEK($D100+K+1)    POKE $D200+K, PEEK($D200+K+1)    POKE $D300+K, PEEK($D300+K+1)  NEXT K  POKE $D100+31, TEMPR  POKE $D200+31, TEMPG  POKE $D300+31, TEMPB  RETURN.DRAW¯LOGO'---------  BACKGROUND 1  BORDER 1  EDMA 0, 2000, $40000, $800  EDMA 0, 2000, $407D0, $FF80000  RETURN.FADE¯TO¯WHITE'-------------  FOR FADEVAL=0 TO 16    GOSUB FADE¯COLOURS¯TO¯WHITE    SLEEP .05  NEXT FADEVAL  RETURN.FADE¯TO¯BLACK'-------------  GOSUB STORE¯CURR¯COLOURS  FOR FADEVAL=0 TO 16    GOSUB FADE¯COLOURS¯TO¯BLACK    SLEEP .05  NEXT FADEVAL  RETURN.FADE¯TO¯DEFAULTS'----------------  GOSUB STORE¯CURR¯COLOURS  FOR FADEVAL=0 TO 16    GOSUB FADE¯COLOURS¯TO¯DEFAULTS    SLEEP .05  NEXT FADEVAL  RETURN'====.INIT'====  ' SWITCH BACK TO UPPER-CASE  POKE $D018, PEEK($D018) AND $FD  ^^BLOAD "INTRO.DAT",P($40000),R  ' $4,0000 +------------------+ ÉÎÔÒÏ.ÄÁÔ  '         ! ÂÁÓ LOGO CHARS   !  ' $4,07Ä0 +..................+  '         ! ÂÁÓ LOGO COLORS  !  ' $4,0ÆÁ0 +..................+  '         ! 32 X ÒÇÂ ÐÁÌÅÔÔÅ !  ' $4,1000 +..................+  '         ! ÔÉÔÌÅ COLORS     !  ' $4,270Ã +..................+  GOSUB INIT¯MUSIC  GOSUB STORE¯DEFAULT¯COLOURS  RETURN.STORE¯DEFAULT¯COLOURS'---------------------  FOR K = 0 TO 31    DEFAULT¯RED(K)=PEEK($D100+K)    DEFAULT¯GREEN(K)=PEEK($D200+K)    DEFAULT¯BLUE(K)=PEEK($D300+K)  NEXT K  RETURN.STORE¯CURR¯COLOURS'------------------  FOR K = 0 TO 31    CURR¯RED(K)=PEEK($D100+K)    CURR¯GREEN(K)=PEEK($D200+K)    CURR¯BLUE(K)=PEEK($D300+K)  NEXT K  RETURN.FADE¯COLOURS¯TO¯WHITE'---------------------  'ÉÎÐÕÔ: FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16  FOR K = 0 TO 31    POKE $D100+K, DEFAULT¯RED(K) + (15 - DEFAULT¯RED(K)) * TEMPVAL    POKE $D200+K, DEFAULT¯GREEN(K) + (15 - DEFAULT¯GREEN(K)) * TEMPVAL    POKE $D300+K, DEFAULT¯BLUE(K) + (15 - DEFAULT¯BLUE(K)) * TEMPVAL  NEXT K  RETURN.FADE¯COLOURS¯TO¯DEFAULTS'------------------------  'ÉÎÐÕÔ: FADEVAL=0 TO 16  TEMPVAL = FADEVAL / 16  FOR K = 0 TO 31    POKE $D100+K, CURR¯RED(K) + (DEFAULT¯RED(K)-CURR¯RED(K)) * TEMPVAL    POKE $D200+K, CURR¯GREEN(K) + (DEFAULT¯GREEN(K)-CURR¯GREEN(K)) * TEMPVAL    POKE $D300+K, CURR¯BLUE(K) + (DEFAULT¯BLUE(K)-CURR¯BLUE(K)) * TEMPVAL  NEXT K  RETURN.FADE¯COLOURS¯TO¯BLACK'---------------------  TEMPVAL = (16-FADEVAL) / 16  FOR K = 0 TO 31    POKE $D100+K, CURR¯RED(K) * TEMPVAL    POKE $D200+K, CURR¯GREEN(K) * TEMPVAL    POKE $D300+K, CURR¯BLUE(K) * TEMPVAL  NEXT K  RETURN'==========.INIT¯MUSIC'==========  PLAY  BAR¯INDEX=0  MAP¯BAR¯TO¯CHUNK(0)=0  MAP¯BAR¯TO¯CHUNK(1)=1  MAP¯BAR¯TO¯CHUNK(2)=1  MAP¯BAR¯TO¯CHUNK(3)=2  MAP¯BAR¯TO¯CHUNK(4)=3  FILTER 1,100,1  FILTER 2,100,1  ENVELOPE 2,3,3,3,10,0  ENVELOPE 4,9,4,9,8  ENVELOPE 7,0,9,9,0,2,1100  ENVELOPE 8,0,12,3,5,2,1100  ENVELOPE 9,0,10,3,5,2,1100  ' *** VOICE1 - GUITAR1 ***  ' ------------------------  V1$(0)="T2O6M2 QDIR QC.R QDIR QC.R QDIR QC.R QDIR QC.R"  V1$(1)="T2O6M2 QDIR QC.R QDIR QC.R P9A IR QAIR P0IDP9O5A O5IAO6DA Q.G IDO5A IBO6DG Q.A IGD O5BO6EG Q.A IGE O5IBO6DG Q.A IGD  O5BO6EGQA IG#FE "  V1$(2)="T2O6M2 QDIR QC.R QDIR QC.R  IDDFQ.DIFD O5Q.#AHO6CIR O5#AQ#AO6HCIR IDDFHDIR  DDFQ.DIFD O5Q.#AHO6CIR O5#AQ#AO6HCIR O5Q.A O6HE IR  V1$(3)="T2O6M2 IGG#GHGIR O5Q.G O6HD IR AA#AHA IR A O6D #F QE I#F QD  Q.#F.EDO6.G.#FE O5G I#A O6 QE O5I#A O6QE QDIR QC.R QDIR QC.R  V1$(3)=V1$(3)+"O6Q.G.#FE O5G I#A O6QE O5I#A O6QE QDIR QC.R QDIR QC.R QDIR QC.R QDIR QC.R"  ' *** VOICE2 - GUITAR2 ***  ' ------------------------  V2$(0)="T2O5M4 QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R"  V2$(1)="T2O5M4 QAIR Q#G.R QAIR Q#G.R  O5 Q.#C .D O6I#FD O5D#FAO6Q.D IO5A#F  EGBO6Q.E O5IBG EAO6#CQ.E I#CO5A EGBO6Q.E O5IBG EAO6#CQE ID#CD"  V2$(2)="T2O5M4 QAIR Q#G.R QAIR Q#G.R  IAAO6CO5Q.AIGA Q.FHG IR IFQF HG IR IAAO6CO5HA IR  AAO6CO5Q.AIGA Q.FHG IRFQF HG IR Q.E .A O6E "  V2$(3)="T2O5M4 IGG#G HG IR Q.D HG IR DDGHD IR DDAQGIAQD Q.A.G#F .#A .A G  O5QEIGQ#AIG#AO6C QAIR Q#G.R QAIR Q#G.R Q.#A .A G O5QEIGQ#AIG#AO6C"  V2$(3)=V2$(3)+"QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R QAIR Q#G.R"  ' *** VOICE3 - BASS ***  ' ---------------------  V3$(0)="X1T7O2M1 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A   O2ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  V3$(1)="X1T7O2M1 ID QR P1 ICD QR ICD SF#F QD QR IR O1A T8 O2Q.#CQD IDE#F Q.#F O1A IA O2Q#C O1Q.E E IEBG Q.A A IA O2QC Q.E E IE O1 QB Q.A A O2IE QA"  V3$(2)="X1T7O2M1 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  V3$(2)=V3$(2)+"T9O2IDDDDDDDD O1#A#A#A#A#A#A#A#A #A#A#A#A#A#A#A#A O2DDFQDIDDDDDDDDDDD O1#A#A#A#A#A#A#A#A #A#A#A T8O2QCICCC O1Q.AAIAAA"  V3$(3)="O2Q.DDIDDD O1Q.GGI#AA#A Q.#A#AI#AQ#A Q.AAIAQA O2Q.DDIO1GO2QD Q.EEIEQE O1Q.AAIAQA T7O2 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  V3$(3)=V3$(3)+"O2Q.EEIEQE O1Q.AAIAQA T7O2 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A  T7O2 ID QR P1 ICD QR ICD SF#F QD IR O1AO2CO1A"  ' *** VOICE4 - MELODY ***  ' -----------------------  V4$(0)=""  V4$(1)="T4O5P0 QR M2ID M4QD P5 M1O4#G H.A IAQA   O5Q.E H#F IR #F#FA QG IG#F W M5 .G P9M2O4IA O5I.B.A SG#F AGABAB QG O4IAB O5H#F SG#F Q.E.D"  V4$(2)="O5T4P7WDHRQ.RICP5O5IDDFQ.GIFDQ.FSEDHCIFFAQGIFDSCP2H.DP5I.RICDDFQ.GIFD Q.F SED HC IFFAQGIFD IGP1H.A P7IRA"  V4$(3)="T4 IO6DD#DQDICO5#AH.#AQ.R IAA#AQAIAGP1WAP7IR"  V4$(3)=V4$(3)+"HRI#FGAQ.GI#FG#FHERIR DHDRR IR#FGAQ.GI#FG#FHERIR DHD"  RETURN'---------.POLL¯PLAY'---------  IF RPLAY(1) THEN RETURN  MUSIC¯CHUNK¯INDEX=MAP¯BAR¯TO¯CHUNK(BAR¯INDEX)    PLAY V1$(MUSIC¯CHUNK¯INDEX),V3$(MUSIC¯CHUNK¯INDEX),V4$(MUSIC¯CHUNK¯INDEX)  SLEEP .05  PLAY ,,,V2$(MUSIC¯CHUNK¯INDEX),V3$(MUSIC¯CHUNK¯INDEX),V4$(MUSIC¯CHUNK¯INDEX)  BAR¯INDEX=BAR¯INDEX+1  IF BAR¯INDEX=5 THEN BAR¯INDEX=1  RETURN